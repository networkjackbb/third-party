Code from third party sources I have tried to make better.
